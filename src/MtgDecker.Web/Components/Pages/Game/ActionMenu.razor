@using MtgDecker.Engine
@using MtgDecker.Engine.Enums
@namespace MtgDecker.Web.Components.Pages.Game

@if (Visible)
{
    <MudPaper Elevation="12" Class="pa-2"
              Style="width: 200px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.12);">
        <MudText Typo="Typo.caption" Class="px-2 py-1"
                 Style="font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
            @CardName
        </MudText>

        <MudStack Spacing="0">
            @if (IsOwnCard && CurrentZone == ZoneType.Hand)
            {
                <MudButton Size="Size.Small" Variant="Variant.Text" FullWidth="true"
                           StartIcon="@Icons.Material.Filled.PlayArrow" Color="Color.Success"
                           Style="justify-content: flex-start;"
                           OnClick="() => OnPlay.InvokeAsync()">Play</MudButton>
            }

            @if (IsOwnCard && CurrentZone == ZoneType.Battlefield)
            {
                <MudButton Size="Size.Small" Variant="Variant.Text" FullWidth="true"
                           StartIcon="@(IsTapped ? Icons.Material.Filled.Undo : Icons.Material.Filled.RotateRight)"
                           Color="Color.Info" Style="justify-content: flex-start;"
                           OnClick="() => OnTapToggle.InvokeAsync()">
                    @(IsTapped ? "Untap" : "Tap")
                </MudButton>
            }

            <MudDivider Class="my-1" />
            <MudText Typo="Typo.overline" Class="px-2" Style="color: var(--mud-palette-text-secondary);">Move to</MudText>

            @foreach (var zone in AvailableZones)
            {
                <MudButton Size="Size.Small" Variant="Variant.Text" FullWidth="true"
                           StartIcon="@Icons.Material.Filled.DriveFileMove"
                           Style="justify-content: flex-start;"
                           OnClick="() => OnMoveTo.InvokeAsync(zone)">@zone</MudButton>
            }

            <MudDivider Class="my-1" />
            <MudButton Size="Size.Small" Variant="Variant.Text" FullWidth="true"
                       StartIcon="@Icons.Material.Filled.Close" Color="Color.Default"
                       Style="justify-content: flex-start;"
                       OnClick="() => OnClose.InvokeAsync()">Cancel</MudButton>
        </MudStack>
    </MudPaper>
}

@code {
    [Parameter] public bool Visible { get; set; }
    [Parameter] public string CardName { get; set; } = "";
    [Parameter] public ZoneType CurrentZone { get; set; }
    [Parameter] public bool IsOwnCard { get; set; }
    [Parameter] public bool IsTapped { get; set; }
    [Parameter] public EventCallback OnPlay { get; set; }
    [Parameter] public EventCallback OnTapToggle { get; set; }
    [Parameter] public EventCallback<ZoneType> OnMoveTo { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }

    private IEnumerable<ZoneType> AvailableZones =>
        Enum.GetValues<ZoneType>().Where(z => z != CurrentZone);
}
