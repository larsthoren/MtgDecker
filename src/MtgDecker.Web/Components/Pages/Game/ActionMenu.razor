@using MtgDecker.Engine
@using MtgDecker.Engine.Enums
@namespace MtgDecker.Web.Components.Pages.Game

@if (Visible)
{
    <MudPaper Elevation="12" Class="pa-2"
              Style="width: 200px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.12);">
        <MudText Typo="Typo.caption" Class="px-2 py-1"
                 Style="font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
            @CardName
        </MudText>

        <MudStack Spacing="0">
            @if (IsOwnCard && CurrentZone == ZoneType.Hand)
            {
                <MudButton Size="Size.Small" Variant="Variant.Text" FullWidth="true"
                           StartIcon="@Icons.Material.Filled.PlayArrow" Color="Color.Success"
                           Style="justify-content: flex-start;"
                           OnClick="() => OnPlay.InvokeAsync()">Play</MudButton>
            }

            @if (IsOwnCard && CurrentZone == ZoneType.Hand && HasAlternateCost)
            {
                <MudButton Size="Size.Small" Variant="Variant.Text" FullWidth="true"
                           StartIcon="@Icons.Material.Filled.SwapHoriz" Color="Color.Warning"
                           Style="justify-content: flex-start;"
                           OnClick="() => OnPlayAlternate.InvokeAsync()">Cast (alt cost)</MudButton>
            }

            @if (IsOwnCard && CurrentZone == ZoneType.Hand && HasNinjutsuCost)
            {
                <MudButton Size="Size.Small" Variant="Variant.Text" FullWidth="true"
                           StartIcon="@Icons.Material.Filled.SwapHoriz" Color="Color.Secondary"
                           Style="justify-content: flex-start;"
                           OnClick="() => OnNinjutsu.InvokeAsync()">Ninjutsu</MudButton>
            }

            @if (IsOwnCard && CurrentZone == ZoneType.Battlefield && !IsTapped && HasTapAbility)
            {
                <MudButton Size="Size.Small" Variant="Variant.Text" FullWidth="true"
                           StartIcon="@Icons.Material.Filled.RotateRight"
                           Color="Color.Info" Style="justify-content: flex-start;"
                           OnClick="() => OnTapToggle.InvokeAsync()">Tap</MudButton>
            }

            @if (IsOwnCard && CurrentZone == ZoneType.Battlefield && HasActivatedAbility)
            {
                <MudButton Size="Size.Small" Variant="Variant.Text" FullWidth="true"
                           StartIcon="@Icons.Material.Filled.FlashOn"
                           Color="Color.Warning" Style="justify-content: flex-start;"
                           OnClick="() => OnActivate.InvokeAsync()">Activate</MudButton>
            }

            <MudDivider Class="my-1" />
            <MudButton Size="Size.Small" Variant="Variant.Text" FullWidth="true"
                       StartIcon="@Icons.Material.Filled.Close" Color="Color.Default"
                       Style="justify-content: flex-start;"
                       OnClick="() => OnClose.InvokeAsync()">Cancel</MudButton>
        </MudStack>
    </MudPaper>
}

@code {
    [Parameter] public bool Visible { get; set; }
    [Parameter] public string CardName { get; set; } = "";
    [Parameter] public ZoneType CurrentZone { get; set; }
    [Parameter] public bool IsOwnCard { get; set; }
    [Parameter] public bool IsTapped { get; set; }
    [Parameter] public bool HasTapAbility { get; set; }
    [Parameter] public bool HasActivatedAbility { get; set; }
    [Parameter] public bool HasAlternateCost { get; set; }
    [Parameter] public bool HasNinjutsuCost { get; set; }
    [Parameter] public EventCallback OnPlay { get; set; }
    [Parameter] public EventCallback OnPlayAlternate { get; set; }
    [Parameter] public EventCallback OnNinjutsu { get; set; }
    [Parameter] public EventCallback OnTapToggle { get; set; }
    [Parameter] public EventCallback OnActivate { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }
}
