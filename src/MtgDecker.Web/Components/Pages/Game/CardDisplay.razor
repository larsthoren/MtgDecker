@namespace MtgDecker.Web.Components.Pages.Game

<div class="card-display @(Tapped ? "tapped" : "") @(Selected ? "selected" : "") @(Clickable ? "clickable" : "") @(IsAttacking ? "attacking" : "") @(IsBlocking ? "blocking" : "") @(Eligible ? "eligible" : "")"
     style="width: @(CardSize)px; min-height: @(CardSize * 1.4)px;"
     @onclick="HandleClick">
    @if (IsBack)
    {
        <div class="card-back">
            <MudIcon Icon="@Icons.Material.Filled.Help" Size="Size.Large" />
        </div>
    }
    else if (!string.IsNullOrEmpty(ImageUrl))
    {
        <img src="@ImageUrl" alt="@Name" loading="lazy" />
    }
    else
    {
        <div class="card-placeholder">
            <MudText Typo="Typo.caption" Align="Align.Center">@Name</MudText>
        </div>
    }

    @if (Power.HasValue && Toughness.HasValue)
    {
        <div class="pt-badge @(DamageMarked > 0 ? "damaged" : "")">
            @Power/@(Math.Max(0, Toughness.Value - DamageMarked))
        </div>
    }

    @if (IsAttacking)
    {
        <div class="combat-indicator attacking-indicator">ATK</div>
    }
    @if (IsBlocking)
    {
        <div class="combat-indicator blocking-indicator">BLK</div>
    }
</div>

@code {
    [Parameter] public string? ImageUrl { get; set; }
    [Parameter] public string Name { get; set; } = "";
    [Parameter] public int CardSize { get; set; } = 100;
    [Parameter] public bool Tapped { get; set; }
    [Parameter] public bool IsBack { get; set; }
    [Parameter] public bool Selected { get; set; }
    [Parameter] public bool Clickable { get; set; } = true;
    [Parameter] public EventCallback OnClick { get; set; }
    [Parameter] public int? Power { get; set; }
    [Parameter] public int? Toughness { get; set; }
    [Parameter] public int DamageMarked { get; set; }
    [Parameter] public bool IsAttacking { get; set; }
    [Parameter] public bool IsBlocking { get; set; }
    [Parameter] public bool Eligible { get; set; }

    private async Task HandleClick()
    {
        if (Clickable)
            await OnClick.InvokeAsync();
    }
}
